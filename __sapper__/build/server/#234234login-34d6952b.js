'use strict';

function _interopDefault (ex) { return (ex && (typeof ex === 'object') && 'default' in ex) ? ex['default'] : ex; }

var index = require('./index-7460d1f3.js');
require('./index-4169654c.js');
var Cookie = _interopDefault(require('cookie-universal'));
require('./api-9d8f7f34.js');
var app$1 = require('./app-19cb53d9.js');
var Textbox = require('./Textbox-2638839c.js');
require('./index-eb724975.js');
var Passwordbox = require('./Passwordbox-067002f9.js');
var Header = require('./Header-8a9931f8.js');
require('./auth-c7f15797.js');
require('./cart-d14f702b.js');

/* src\routes\#234234login.svelte generated by Svelte v3.16.4 */

const css = {
	code: ".container.svelte-3hwxzk{max-height:80vh !important;min-height:80vh !important}.wraper-hide.svelte-3hwxzk{visibility:hidden}.otp-container.svelte-3hwxzk{height:48px;width:136px;background-color:#eff1f4;border-radius:4px;position:relative;display:inline-block}.otp-container.svelte-3hwxzk .otp-seperator.svelte-3hwxzk{background-color:#dfe1e6;border:1px solid #dfe1e6}.otp-container.svelte-3hwxzk #wraper1.svelte-3hwxzk{top:20px;left:28px}.otp-container.svelte-3hwxzk #wraper2.svelte-3hwxzk{top:20px;left:51px}.otp-container.svelte-3hwxzk #wraper3.svelte-3hwxzk{top:20px;left:76px}.otp-container.svelte-3hwxzk #wraper4.svelte-3hwxzk{top:20px;left:100px}.otp-container.svelte-3hwxzk .otp-content.svelte-3hwxzk{height:inherit;width:150px;background-color:transparent;border:1px solid transparent;outline:transparent;letter-spacing:15px;font-size:22px;padding-left:16px}",
	map: "{\"version\":3,\"file\":\"#234234login.svelte\",\"sources\":[\"#234234login.svelte\"],\"sourcesContent\":[\"<script>\\r\\n  import { stores, goto } from \\\"@sapper/app\\\";\\r\\n  const { session, page } = stores();\\r\\n  import { get, put, post } from \\\"./../lib/api\\\";\\r\\n  import Cookie from \\\"cookie-universal\\\";\\r\\n  const cookies = Cookie();\\r\\n  import { toast } from \\\"./../actions/toast.js\\\";\\r\\n  import Textbox from \\\"./../components/ui/Textbox.svelte\\\";\\r\\n  import Passwordbox from \\\"./../components/ui/Passwordbox.svelte\\\";\\r\\n  import Header from \\\"./../components/Header.svelte\\\";\\r\\n  import { fadeIn, fadeOut } from \\\"./../actions/pageFade\\\";\\r\\n  let loading = false,\\r\\n    disable = \\\"disable\\\",\\r\\n    p = {},\\r\\n    msg = null,\\r\\n    signup = false,\\r\\n    uid = \\\"\\\",\\r\\n    password = \\\"\\\",\\r\\n    firstName = \\\"\\\",\\r\\n    lastName = \\\"\\\",\\r\\n    otp = \\\"\\\",\\r\\n    showOTP = false,\\r\\n    phoneno = /^[+()\\\\d-]+$/,\\r\\n    submitText = \\\"Verify\\\",\\r\\n    err = null;\\r\\n  $: isEmail = uid.includes(\\\"@\\\");\\r\\n  $: isPhone = uid.length >= 10 && uid.match(phoneno) ? true : false;\\r\\n  $: if (otp) {\\r\\n    if (otp.length == 4) {\\r\\n      phoneLogin();\\r\\n    }\\r\\n  }\\r\\n  $: if (uid) {\\r\\n    showOTP = false;\\r\\n    signup = false;\\r\\n  }\\r\\n  $: if (signup) {\\r\\n    submitText = \\\"Signup New Account\\\";\\r\\n  } else if (!isPhone && !isEmail && !showOTP) {\\r\\n    submitText = \\\"Verify\\\";\\r\\n  } else if (isPhone && !showOTP) {\\r\\n    submitText = \\\"Verify Phone\\\";\\r\\n  } else if (isEmail && !showOTP) {\\r\\n    submitText = \\\"Verify Email\\\";\\r\\n  } else if (isPhone && showOTP) {\\r\\n    submitText = \\\"Verify OTP\\\";\\r\\n  } else {\\r\\n    submitText = \\\"Login Now\\\";\\r\\n  }\\r\\n  async function submit() {\\r\\n    msg = err = null;\\r\\n    if (!uid || uid == \\\"\\\") {\\r\\n      err = \\\"Please enter your email/phone no\\\";\\r\\n      return;\\r\\n    }\\r\\n    if (!isPhone && !isEmail) {\\r\\n      err = \\\"Entered email is not valid\\\";\\r\\n      return;\\r\\n    }\\r\\n    if (isPhone) {\\r\\n      await phoneLogin();\\r\\n    } else {\\r\\n      await emailLogin();\\r\\n    }\\r\\n  }\\r\\n  async function phoneLogin() {\\r\\n    // toast.show({ show: true, color: \\\"err\\\", msg: \\\"error...\\\", duration: 7000 });\\r\\n    loading = true;\\r\\n    if (!showOTP) {\\r\\n      // When clicked 1st time\\r\\n      try {\\r\\n        const otp = await get(\\\"users/phone/\\\" + uid);\\r\\n        showOTP = true;\\r\\n        msg = \\\"Please enter OTP sent to your Mobile\\\";\\r\\n        // $refs.otp.focus();\\r\\n        return;\\r\\n      } catch (e) {\\r\\n        err = e;\\r\\n        console.log(\\\"err...\\\", e);\\r\\n      } finally {\\r\\n        loading = false;\\r\\n      }\\r\\n    } else {\\r\\n      // Final submission\\r\\n      try {\\r\\n        loading = true;\\r\\n        const u = await post(\\\"auth/local\\\", { uid, password: otp });\\r\\n        $session.user = u.user;\\r\\n        $session.token = u.token;\\r\\n        cookies.set(\\\"token\\\", u.token);\\r\\n        goto(\\\"/\\\");\\r\\n      } catch (e) {\\r\\n        err = e;\\r\\n      } finally {\\r\\n        loading = false;\\r\\n      }\\r\\n    }\\r\\n  }\\r\\n  async function emailLogin() {\\r\\n    if (!showOTP) {\\r\\n      // When clicked 1st time\\r\\n      try {\\r\\n        const otp = await get(\\\"users/email/\\\" + uid);\\r\\n        showOTP = true;\\r\\n        msg = \\\"Please enter your password\\\";\\r\\n        // $refs.otp.focus();\\r\\n        return;\\r\\n      } catch (e) {\\r\\n        if (e.response && e.response.status == \\\"400\\\") {\\r\\n          signup = true;\\r\\n          showOTP = true;\\r\\n          console.log(\\\"400 err...\\\", e.response.status);\\r\\n        } else {\\r\\n          signup = true;\\r\\n          showOTP = true;\\r\\n          console.log(\\\"err...\\\", e.toString());\\r\\n        }\\r\\n        err = \\\"\\\";\\r\\n      } finally {\\r\\n        showOTP = true;\\r\\n        loading = false;\\r\\n      }\\r\\n    } else {\\r\\n      // Final submission\\r\\n      try {\\r\\n        loading = true;\\r\\n        let u = {};\\r\\n        if (signup) {\\r\\n          // Signup\\r\\n          u = await post(\\\"users\\\", {\\r\\n            email: uid,\\r\\n            firstName: firstName,\\r\\n            lastName: lastName,\\r\\n            password\\r\\n          });\\r\\n        } else {\\r\\n          // Login\\r\\n          u = await post(\\\"auth/local\\\", { uid, password });\\r\\n        }\\r\\n        $session.user = u.user;\\r\\n        $session.token = u.token;\\r\\n        cookies.set(\\\"token\\\", u.token);\\r\\n        // showOTP = true;\\r\\n        goto(\\\"/\\\");\\r\\n        // $refs.password.focus();\\r\\n      } catch (e) {\\r\\n        showOTP = false;\\r\\n        err = e;\\r\\n        // $refs.uid.focus();\\r\\n      } finally {\\r\\n        showOTP = true;\\r\\n        loading = false;\\r\\n      }\\r\\n    }\\r\\n  }\\r\\n</script>\\r\\n\\r\\n<style>\\r\\n  .container {\\r\\n    max-height: 80vh !important;\\r\\n    min-height: 80vh !important;\\r\\n  }\\r\\n  .wraper-hide {\\r\\n    visibility: hidden;\\r\\n  }\\r\\n  .otp-container {\\r\\n    height: 48px;\\r\\n    width: 136px;\\r\\n    background-color: #eff1f4;\\r\\n    border-radius: 4px;\\r\\n    position: relative;\\r\\n    display: inline-block;\\r\\n  }\\r\\n  .otp-container .otp-seperator {\\r\\n    background-color: #dfe1e6;\\r\\n    border: 1px solid #dfe1e6;\\r\\n  }\\r\\n  .otp-container #wraper1 {\\r\\n    top: 20px;\\r\\n    left: 28px;\\r\\n  }\\r\\n  .otp-container #wraper2 {\\r\\n    top: 20px;\\r\\n    left: 51px;\\r\\n  }\\r\\n  .otp-container #wraper3 {\\r\\n    top: 20px;\\r\\n    left: 76px;\\r\\n  }\\r\\n  .otp-container #wraper4 {\\r\\n    top: 20px;\\r\\n    left: 100px;\\r\\n  }\\r\\n  .otp-container .otp-content {\\r\\n    height: inherit;\\r\\n    width: 150px;\\r\\n    background-color: transparent;\\r\\n    border: 1px solid transparent;\\r\\n    outline: transparent;\\r\\n    letter-spacing: 15px;\\r\\n    font-size: 22px;\\r\\n    padding-left: 16px;\\r\\n  }\\r\\n</style>\\r\\n\\r\\n<svelte:head>\\r\\n  <title>Login to Hopyshopy</title>\\r\\n  <meta\\r\\n    data-hid=\\\"description\\\"\\r\\n    name=\\\"description\\\"\\r\\n    content=\\\"Login to Hopyshopy\\\" />\\r\\n  <meta data-hid=\\\"og:title\\\" name=\\\"og_title\\\" content=\\\"Login to Hopyshopy\\\" />\\r\\n</svelte:head>\\r\\n<main in:fadeIn out:fadeOut>\\r\\n  <Header home={true} />\\r\\n\\r\\n  <div class=\\\"relative z-50\\\">\\r\\n    <div class=\\\"h-full px-4\\\">\\r\\n      <div class=\\\"container mx-auto flex items-center justify-center\\\">\\r\\n        <div class=\\\"w-full md:w-1/2 lg:w-1/3 mb-6 rounded shadow-2xl\\\">\\r\\n          <div>\\r\\n            <p class=\\\"mb-2 p-2 text-xs bg-yellow-400 rounded\\\">\\r\\n              SMS provider configured only for Indian Numbers. Please use email\\r\\n              instead\\r\\n            </p>\\r\\n          </div>\\r\\n          <div class=\\\"p-0 secondary text-white rounded rounded-b-none\\\">\\r\\n            <h1 class=\\\"text-xl mb-6 text-left p-3\\\">\\r\\n              {#if !signup}\\r\\n                <span class=\\\"font-extrabold\\\">SIGN IN</span>\\r\\n              {:else}\\r\\n                <span class=\\\"font-extrabold\\\">SIGN UP</span>\\r\\n                TO YOUR ACCOUNT\\r\\n              {/if}\\r\\n            </h1>\\r\\n          </div>\\r\\n          <form on:submit|preventDefault={submit} class=\\\"center bg-white\\\">\\r\\n            <div class=\\\"p-6 lg:p-12\\\">\\r\\n              {#if err}\\r\\n                <div class=\\\"text-red-600 mb-5 text-center\\\">{err}</div>\\r\\n              {:else if msg}\\r\\n                <div class=\\\"text-green-600 mb-5 text-center\\\">{msg}</div>\\r\\n              {/if}\\r\\n              <Textbox bind:value={uid} label=\\\"Email/Phone\\\" />\\r\\n              <br />\\r\\n              {#if signup}\\r\\n                <Textbox value={firstName} label=\\\"Fisrt Name\\\" class=\\\"w-full\\\" />\\r\\n                <br />\\r\\n                <Textbox value={lastName} label=\\\"Last Name\\\" class=\\\"w-full\\\" />\\r\\n                <br />\\r\\n              {/if}\\r\\n              <!-- <p class=\\\"text-red-500 mb-5 text-xs font-hairline\\\">Please enter password</p> -->\\r\\n\\r\\n              {#if !isPhone && showOTP}\\r\\n                <!-- Show password box -->\\r\\n                <Passwordbox\\r\\n                  bind:value={password}\\r\\n                  label=\\\"Password\\\"\\r\\n                  cls=\\\"w-full\\\" />\\r\\n              {:else if showOTP}\\r\\n                <!-- Show OTP box -->\\r\\n                <div class=\\\" flex justify-center text-center\\\">\\r\\n                  <div class=\\\"otp-container\\\">\\r\\n                    <div\\r\\n                      id=\\\"wraper1\\\"\\r\\n                      class=\\\"otp-seperator w-1 h-1 rounded absolute\\\"\\r\\n                      class:wraper-hide={otp.length > 0} />\\r\\n                    <div\\r\\n                      id=\\\"wraper2\\\"\\r\\n                      class=\\\"otp-seperator w-1 h-1 rounded absolute\\\"\\r\\n                      class:wraper-hide={otp.length > 1} />\\r\\n                    <div\\r\\n                      id=\\\"wraper3\\\"\\r\\n                      class=\\\"otp-seperator w-1 h-1 rounded absolute\\\"\\r\\n                      class:wraper-hide={otp.length > 2} />\\r\\n                    <div\\r\\n                      id=\\\"wraper4\\\"\\r\\n                      class=\\\"otp-seperator w-1 h-1 rounded absolute\\\"\\r\\n                      class:wraper-hide={otp.length > 3} />\\r\\n                    <input\\r\\n                      bind:value={otp}\\r\\n                      name=\\\"otp\\\"\\r\\n                      class=\\\"otp-content outline-none pl-4 otp-content w-32\\r\\n                      bg-transparent border border-gray-400\\\"\\r\\n                      maxlength=\\\"4\\\"\\r\\n                      autocomplete=\\\"off\\\" />\\r\\n                  </div>\\r\\n                </div>\\r\\n              {/if}\\r\\n              <br />\\r\\n              <br />\\r\\n              <div class=\\\"flex items-center justify-between\\\">\\r\\n                <button\\r\\n                  type=\\\"submit\\\"\\r\\n                  disabled={loading}\\r\\n                  class=\\\"flex items-center justify-center h-14 text-2xl\\r\\n                  outline-none w-full font-bold py-2 rounded primary\\\"\\r\\n                  class:primary={!loading}\\r\\n                  class:border={loading}>\\r\\n                  {#if loading}\\r\\n                    <img src=\\\"/loading.svg\\\" alt class:loading />\\r\\n                  {:else}{submitText}{/if}\\r\\n                </button>\\r\\n              </div>\\r\\n            </div>\\r\\n          </form>\\r\\n        </div>\\r\\n      </div>\\r\\n    </div>\\r\\n  </div>\\r\\n</main>\\r\\n\"],\"names\":[],\"mappings\":\"AA8JE,UAAU,cAAC,CAAC,AACV,UAAU,CAAE,IAAI,CAAC,UAAU,CAC3B,UAAU,CAAE,IAAI,CAAC,UAAU,AAC7B,CAAC,AACD,YAAY,cAAC,CAAC,AACZ,UAAU,CAAE,MAAM,AACpB,CAAC,AACD,cAAc,cAAC,CAAC,AACd,MAAM,CAAE,IAAI,CACZ,KAAK,CAAE,KAAK,CACZ,gBAAgB,CAAE,OAAO,CACzB,aAAa,CAAE,GAAG,CAClB,QAAQ,CAAE,QAAQ,CAClB,OAAO,CAAE,YAAY,AACvB,CAAC,AACD,4BAAc,CAAC,cAAc,cAAC,CAAC,AAC7B,gBAAgB,CAAE,OAAO,CACzB,MAAM,CAAE,GAAG,CAAC,KAAK,CAAC,OAAO,AAC3B,CAAC,AACD,4BAAc,CAAC,QAAQ,cAAC,CAAC,AACvB,GAAG,CAAE,IAAI,CACT,IAAI,CAAE,IAAI,AACZ,CAAC,AACD,4BAAc,CAAC,QAAQ,cAAC,CAAC,AACvB,GAAG,CAAE,IAAI,CACT,IAAI,CAAE,IAAI,AACZ,CAAC,AACD,4BAAc,CAAC,QAAQ,cAAC,CAAC,AACvB,GAAG,CAAE,IAAI,CACT,IAAI,CAAE,IAAI,AACZ,CAAC,AACD,4BAAc,CAAC,QAAQ,cAAC,CAAC,AACvB,GAAG,CAAE,IAAI,CACT,IAAI,CAAE,KAAK,AACb,CAAC,AACD,4BAAc,CAAC,YAAY,cAAC,CAAC,AAC3B,MAAM,CAAE,OAAO,CACf,KAAK,CAAE,KAAK,CACZ,gBAAgB,CAAE,WAAW,CAC7B,MAAM,CAAE,GAAG,CAAC,KAAK,CAAC,WAAW,CAC7B,OAAO,CAAE,WAAW,CACpB,cAAc,CAAE,IAAI,CACpB,SAAS,CAAE,IAAI,CACf,YAAY,CAAE,IAAI,AACpB,CAAC\"}"
};

const _234234login = index.create_ssr_component(($$result, $$props, $$bindings, $$slots) => {
	let $session;
	const { session, page } = app$1.stores$1();
	$session = index.get_store_value(session);
	const cookies = Cookie();

	let loading = false,
		msg = null,
		signup = false,
		uid = "",
		password = "",
		firstName = "",
		lastName = "",
		otp = "",
		showOTP = false,
		phoneno = /^[+()\d-]+$/,
		submitText = "Verify",
		err = null;

	$$result.css.add(css);
	let $$settled;
	let $$rendered;

	do {
		$$settled = true;
		$session = index.get_store_value(session);
		let isEmail = uid.includes("@");
		let isPhone = uid.length >= 10 && uid.match(phoneno) ? true : false;

		 {
			if (uid) {
				showOTP = false;
				signup = false;
			}
		}

		 {
			if (signup) {
				submitText = "Signup New Account";
			} else if (!isPhone && !isEmail && !showOTP) {
				submitText = "Verify";
			} else if (isPhone && !showOTP) {
				submitText = "Verify Phone";
			} else if (isEmail && !showOTP) {
				submitText = "Verify Email";
			} else if (isPhone && showOTP) {
				submitText = "Verify OTP";
			} else {
				submitText = "Login Now";
			}
		}

		$$rendered = `${($$result.head += `<title>Login to Hopyshopy</title><meta data-hid="${"description"}" name="${"description"}" content="${"Login to Hopyshopy"}"><meta data-hid="${"og:title"}" name="${"og_title"}" content="${"Login to Hopyshopy"}">`, "")}
<main>
  ${index.validate_component(Header.Header, "Header").$$render($$result, { home: true }, {}, {})}

  <div class="${"relative z-50"}">
    <div class="${"h-full px-4"}">
      <div class="${"container mx-auto flex items-center justify-center svelte-3hwxzk"}">
        <div class="${"w-full md:w-1/2 lg:w-1/3 mb-6 rounded shadow-2xl"}">
          <div>
            <p class="${"mb-2 p-2 text-xs bg-yellow-400 rounded"}">
              SMS provider configured only for Indian Numbers. Please use email
              instead
            </p>
          </div>
          <div class="${"p-0 secondary text-white rounded rounded-b-none"}">
            <h1 class="${"text-xl mb-6 text-left p-3"}">
              ${!signup
		? `<span class="${"font-extrabold"}">SIGN IN</span>`
		: `<span class="${"font-extrabold"}">SIGN UP</span>
                TO YOUR ACCOUNT`}
            </h1>
          </div>
          <form class="${"center bg-white"}">
            <div class="${"p-6 lg:p-12"}">
              ${err
		? `<div class="${"text-red-600 mb-5 text-center"}">${index.escape(err)}</div>`
		: `${msg
			? `<div class="${"text-green-600 mb-5 text-center"}">${index.escape(msg)}</div>`
			: ``}`}
              ${index.validate_component(Textbox.Textbox, "Textbox").$$render(
			$$result,
			{ label: "Email/Phone", value: uid },
			{
				value: $$value => {
					uid = $$value;
					$$settled = false;
				}
			},
			{}
		)}
              <br>
              ${signup
		? `${index.validate_component(Textbox.Textbox, "Textbox").$$render(
				$$result,
				{
					value: firstName,
					label: "Fisrt Name",
					class: "w-full"
				},
				{},
				{}
			)}
                <br>
                ${index.validate_component(Textbox.Textbox, "Textbox").$$render(
				$$result,
				{
					value: lastName,
					label: "Last Name",
					class: "w-full"
				},
				{},
				{}
			)}
                <br>`
		: ``}
              

              ${!isPhone && showOTP
		? `
                ${index.validate_component(Passwordbox.Passwordbox, "Passwordbox").$$render(
				$$result,
				{
					label: "Password",
					cls: "w-full",
					value: password
				},
				{
					value: $$value => {
						password = $$value;
						$$settled = false;
					}
				},
				{}
			)}`
		: `${showOTP
			? `
                <div class="${" flex justify-center text-center"}">
                  <div class="${"otp-container svelte-3hwxzk"}">
                    <div id="${"wraper1"}" class="${[
					"otp-seperator w-1 h-1 rounded absolute svelte-3hwxzk",
					otp.length > 0 ? "wraper-hide" : ""
				].join(" ").trim()}"></div>
                    <div id="${"wraper2"}" class="${[
					"otp-seperator w-1 h-1 rounded absolute svelte-3hwxzk",
					otp.length > 1 ? "wraper-hide" : ""
				].join(" ").trim()}"></div>
                    <div id="${"wraper3"}" class="${[
					"otp-seperator w-1 h-1 rounded absolute svelte-3hwxzk",
					otp.length > 2 ? "wraper-hide" : ""
				].join(" ").trim()}"></div>
                    <div id="${"wraper4"}" class="${[
					"otp-seperator w-1 h-1 rounded absolute svelte-3hwxzk",
					otp.length > 3 ? "wraper-hide" : ""
				].join(" ").trim()}"></div>
                    <input name="${"otp"}" class="${"otp-content outline-none pl-4 otp-content w-32\r\n                      bg-transparent border border-gray-400 svelte-3hwxzk"}" maxlength="${"4"}" autocomplete="${"off"}"${index.add_attribute("value", otp, 1)}>
                  </div>
                </div>`
			: ``}`}
              <br>
              <br>
              <div class="${"flex items-center justify-between"}">
                <button type="${"submit"}" ${loading ? "disabled" : ""} class="${[
			"flex items-center justify-center h-14 text-2xl\r\n                  outline-none w-full font-bold py-2 rounded primary",
			(!loading ? "primary" : "") + " " + (loading ? "border" : "")
		].join(" ").trim()}">
                  ${loading
		? `<img src="${"/loading.svg"}" alt${index.add_classes([loading ? "loading" : ""].join(" ").trim())}>`
		: `${index.escape(submitText)}`}
                </button>
              </div>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>
</main>`;
	} while (!$$settled);

	return $$rendered;
});

exports.default = _234234login;
